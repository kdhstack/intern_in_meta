name: CI/CD(Run & Deploy)

on:
  push:
    branches:
      - main 

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    # defaults:
    #   run:
    #     working-directory: ./prj # <--- ì´ ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê±°ë‚˜, ì•„ëž˜ run ë‹¨ê³„ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
        
    permissions:
      contents: write 

    steps:
      - name: ðŸ›‘ Checkout Code
        uses: actions/checkout@v4
        
      - name: ðŸ› ï¸ Set up Node.js with Caching
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          cache: 'npm' 
          # ðŸ’¡ í•µì‹¬ ìˆ˜ì •: package-lock.jsonì´ ìœ„ì¹˜í•œ ê²½ë¡œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •
          cache-dependency-path: prj/package-lock.json 

      - name: ðŸ“¦ Install dependencies
        # npm installì€ prj í´ë” ë‚´ì—ì„œ ì‹¤í–‰
        run: npm install 
        working-directory: ./prj # <--- npm ëª…ë ¹ì˜ ìž‘ì—… ë””ë ‰í† ë¦¬ ëª…ì‹œ

      - name: ðŸ‘¤ Configure Git User
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          working-directory: ./prj

      - name: âš™ï¸ Run Build and Deploy Script
        # npm run deployë„ prj í´ë” ë‚´ì—ì„œ ì‹¤í–‰
        run: npm run deploy
        working-directory: ./prj # <--- npm ëª…ë ¹ì˜ ìž‘ì—… ë””ë ‰í† ë¦¬ ëª…ì‹œ
