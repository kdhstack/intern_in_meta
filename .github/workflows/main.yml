name: CI/CD(Run & Deploy)

on:
  push:
    branches:
      - main 

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    # 💡 defaults 추가: 이 Job의 모든 'run' 명령은 ./prj 폴더 내에서 실행됩니다.
    defaults:
      run:
        working-directory: ./prj
        
    permissions:
      contents: write 

    steps:
      - name: 🛑 Checkout Code
        uses: actions/checkout@v4
        
      - name: 🛠️ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          cache: 'npm' 
          # 💡 이제 './prj' 내부에서 package-lock.json을 찾게 됩니다.
          # cache-dependency-path를 별도로 지정할 필요 없이 defaults로 해결됩니다.

      - name: 📦 Install dependencies
        # './prj' 내부에서 npm install 실행
        run: npm install 
        
      - name: ⚙️ Run Build and Deploy Script
        # './prj' 내부에서 npm run deploy 실행 (빌드 및 gh-pages 푸시)
        run: npm run deploy
